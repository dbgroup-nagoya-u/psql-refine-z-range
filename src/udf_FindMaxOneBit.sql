CREATE OR REPLACE FUNCTION FindMaxOneBit (
  int_bit int8
) RETURNS
  int4
IMMUTABLE
RETURNS NULL ON NULL INPUT
PARALLEL SAFE
AS $$
DECLARE
  ONE_BIT CONSTANT int8 := 1;
BEGIN
  FOR i IN REVERSE 63..0 LOOP
    IF ((int_bit >> i) & ONE_BIT) = ONE_BIT THEN
      RETURN i;
    END IF;
  END LOOP;
  RETURN NULL;
END;
$$ LANGUAGE plpgsql;
